# version: '4.3'
# A partir de : https://lucidar.me/en/docker/mysql-and-phpmyadmin-with-docker-compose/

services:
    nginx:
        image: nginx:1.22-alpine
        ports:
            - "8084:80"
        volumes:
            - ./:/code
            - ./nginx.conf:/etc/nginx/nginx.conf
    php:
        build: .
        volumes:
        - ./:/code
    
    mysql:
        image: mysql:8.2
        container_name: mysql82
        env_file:
            - .env
        environment:
            MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
            MYSQL_DATABASE: ${MYSQL_DATABASE}
            MYSQL_USER: ${MYSQL_USER}
            MYSQL_PASSWORD: ${MYSQL_PASSWORD}
        ports:
            - "6033:3306" #"6033:3306"
        volumes:
            - mysqldata:/var/lib/mysql
            # - mysqlconf:/etc/mysql/conf.d

    phpmyadmin:
        image: phpmyadmin:5.2.0
        container_name: phpmyadmin52
        environment:
            PMA_HOST: mysql
            MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD} # â¬…ï¸Ž ðŸš¨
        ports:
            - 8085:80

volumes:
    mysqldata:
        driver: local
        driver_opts:
            type: 'none'
            o: 'bind'
            device: './db_server/mysql-phpmyadmin/data'
    # mysqlconf:
    #     driver: local
    #     driver_opts:
    #         type: 'none'
    #         o: 'bind'
    #         device: './db_server/mysql-phpmyadmin/conf'